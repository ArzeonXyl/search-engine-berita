<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pencarian Berita Olahraga</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; background-color: #f8f9fa; }
    header { background-color: #ffffff; padding: 40px 20px 20px; border-bottom: 1px solid #dee2e6; }
    header h1 { font-weight: 300; }
    .search-box { max-width: 600px; margin: 0 auto; }
    .results-container { max-width: 800px; margin: 30px auto; }
    .result-item { background-color: #fff; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin-bottom: 15px; }
    .result-item h3 a { color: #0d6efd; text-decoration: none; font-size: 1.2rem; }
    .result-item h3 a:hover { text-decoration: underline; }
    .result-item p { margin-top: 8px; color: #495057; font-size: 0.95rem; }
    .result-item .score { font-size: 0.85rem; color: #6c757d; margin-top: 10px; }
    #loading-spinner { display: none; text-align: center; padding: 40px; }
  </style>
</head>
<body>
  <header class="text-center">
    <h1>Pencarian Berita Olahraga</h1>
    <div class="search-box">
      <input id="query" type="text" class="form-control form-control-lg" placeholder="Cari berita tentang MotoGP, Tenis, Bulutangkis..." onkeydown="if(event.key==='Enter') fetchResults();"/>
      <div class="d-grid gap-2">
        <button class="btn btn-primary btn-lg mt-2" onclick="fetchResults()">Cari Berita</button>
      </div>
      <div id="error" class="text-danger mt-2 text-center"></div>
    </div>
  </header>

  <div id="loading-spinner">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <div id="results" class="results-container"></div>

  <script>
    // Pastikan URL endpoint sesuai dengan port yang Anda jalankan di app.py
    const API_ENDPOINT = 'http://127.0.0.1:8080/run-python';

    async function fetchResults() {
      const query = document.getElementById('query').value.trim();
      const errorEl = document.getElementById('error');
      const resultsEl = document.getElementById('results');
      const spinnerEl = document.getElementById('loading-spinner');

      if (!query) {
        errorEl.innerText = 'Kolom pencarian tidak boleh kosong!';
        return;
      }

      errorEl.innerText = '';
      resultsEl.innerHTML = '';
      spinnerEl.style.display = 'block';

      try {
        const response = await axios.post(API_ENDPOINT, { query });

        spinnerEl.style.display = 'none';

        if (response.data.output) {
          let results;
          try {
            results = JSON.parse(response.data.output);
          } catch {
            results = [];
          }

          if (results.length > 0) {
            let resultsHTML = '';
            results.forEach(result => {
              const descriptionSnippet = result.isi_berita ? result.isi_berita.substring(0, 250) + '...' : 'Deskripsi tidak tersedia.';
              resultsHTML += `
                <div class="result-item">
                  <h3><a href="${result.url || '#'}" target="_blank" rel="noopener noreferrer">${result.judul || 'Judul Tidak Tersedia'}</a></h3>
                  <p>${descriptionSnippet}</p>
                  <p class="score">Skor Relevansi: ${result.score ? result.score.toFixed(4) : 'N/A'}</p>
                </div>`;
            });
            resultsEl.innerHTML = resultsHTML;
          } else {
            resultsEl.innerHTML = `<div class="alert alert-warning text-center">Tidak ada hasil yang relevan ditemukan untuk query '${query}'.</div>`;
          }
        } else if (response.data.error) {
          errorEl.innerText = response.data.error;
        }

      } catch (error) {
        spinnerEl.style.display = 'none';
        let errorMessage = 'Terjadi kesalahan saat menghubungi server. Pastikan server Python (app.py) sudah berjalan.';
        if (error.response) {
            errorMessage += ` (Status: ${error.response.status})`;
        }
        errorEl.innerText = errorMessage;
        console.error("Error details:", error);
      }
    }
  </script>
</body>
</html>
